---
phase: 01-foundation
plan: 02
type: tdd
wave: 2
depends_on: ["01-01"]
files_modified:
  - bitschema/schema.py
  - bitschema/types.py
  - tests/test_schema.py
autonomous: true

must_haves:
  truths:
    - "Developer can define BooleanField, IntegerField, and EnumField with constraints"
    - "System validates field names are unique within schema"
    - "System rejects invalid field definitions with clear errors"
  artifacts:
    - path: "bitschema/schema.py"
      provides: "BitSchema Pydantic model"
      exports: ["BitSchema"]
      contains: "@field_validator"
    - path: "bitschema/types.py"
      provides: "Field type Pydantic models"
      exports: ["BooleanField", "IntegerField", "EnumField"]
      min_lines: 40
    - path: "tests/test_schema.py"
      provides: "Schema validation tests"
      contains: "test_.*duplicate.*field"
      min_lines: 50
  key_links:
    - from: "bitschema/schema.py"
      to: "bitschema/types.py"
      via: "Union type annotation"
      pattern: "BooleanField.*IntegerField.*EnumField"
    - from: "bitschema/schema.py"
      to: "ValidationError"
      via: "field_validator raises"
      pattern: "@field_validator"
---

<objective>
Implement Pydantic schema models with validation for field definitions.

Purpose: Establish type-safe schema representation using Pydantic BaseModel with automatic validation of field constraints, uniqueness, and type correctness. This enables fail-fast validation at schema parse time.

Output: Validated Pydantic models for BooleanField, IntegerField, EnumField, and BitSchema with comprehensive test coverage.
</objective>

<execution_context>
@/Users/rbrandes/.claude/get-shit-done/workflows/execute-plan.md
@/Users/rbrandes/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@/Users/rbrandes/Documents/private/private-projects/BitSchema/.planning/PROJECT.md
@/Users/rbrandes/Documents/private/private-projects/BitSchema/.planning/REQUIREMENTS.md
@/Users/rbrandes/Documents/private/private-projects/BitSchema/.planning/phases/01-foundation/01-RESEARCH.md
@/Users/rbrandes/Documents/private/private-projects/BitSchema/.planning/phases/01-foundation/01-01-PLAN.md
</context>

<feature>
  <name>Schema Validation with Pydantic</name>
  <files>bitschema/types.py, bitschema/schema.py, tests/test_schema.py</files>
  <behavior>
TDD for schema model validation covering requirements SCHEMA-03, SCHEMA-04, TYPE-01, TYPE-02, TYPE-03.

**Test cases (RED phase):**

1. **BooleanField validation (TYPE-01)**
   - Valid: `{"name": "active", "type": "boolean"}` → BooleanField instance
   - Invalid: `{"name": "active"}` → ValidationError (missing type)
   - Invalid: `{"name": "active", "type": "integer"}` → ValidationError (wrong type)

2. **IntegerField validation (TYPE-02, TYPE-05)**
   - Valid: `{"name": "age", "type": "integer", "min_value": 0, "max_value": 120}` → IntegerField
   - Invalid: `{"name": "age", "type": "integer", "min_value": 100, "max_value": 50}` → ValidationError (max < min)
   - Invalid: `{"name": "age", "type": "integer", "max_value": 100}` → ValidationError (missing min_value)

3. **EnumField validation (TYPE-03)**
   - Valid: `{"name": "status", "type": "enum", "values": ["active", "inactive"]}` → EnumField
   - Invalid: `{"name": "status", "type": "enum", "values": []}` → ValidationError (empty values)
   - Invalid: `{"name": "status", "type": "enum", "values": ["a", "b", "a"]}` → ValidationError (duplicate values)

4. **BitSchema validation (SCHEMA-03, SCHEMA-04)**
   - Valid: `{"version": "1.0", "fields": [boolean_field, integer_field]}` → BitSchema
   - Invalid: `{"fields": [field1, field2]}` where field1.name == field2.name → ValidationError (duplicate field names)
   - Valid: `{"fields": [...]}` (version defaults to "1.0")

**Expected behavior:**
All test cases should validate using Pydantic's built-in validation and custom @field_validator decorators. Errors should include field context.

  </behavior>
  <implementation>
**RED - Write failing tests:**

Create `tests/test_schema.py` with:
- Import pytest, pydantic.ValidationError
- Test functions for each case above using pytest.raises for invalid cases
- Use clear names: `test_boolean_field_valid`, `test_integer_field_max_less_than_min`, etc.
- Run `pytest tests/test_schema.py` - ALL tests must fail (models don't exist yet)
- Commit: `test(01-02): add failing tests for schema validation`

**GREEN - Implement to pass:**

Create `bitschema/types.py`:
- Import: `from pydantic import BaseModel, field_validator; from typing import Literal`
- Define `BooleanField(BaseModel)` with: name: str, type: Literal["boolean"]
- Define `IntegerField(BaseModel)` with: name: str, type: Literal["integer"], min_value: int, max_value: int
  - Add `@field_validator("max_value")` to validate max_value >= min_value
- Define `EnumField(BaseModel)` with: name: str, type: Literal["enum"], values: list[str]
  - Add `@field_validator("values")` to check non-empty and unique

Create `bitschema/schema.py`:
- Import types: `from .types import BooleanField, IntegerField, EnumField`
- Define `FieldType = BooleanField | IntegerField | EnumField`
- Define `BitSchema(BaseModel)` with: version: str = "1.0", fields: list[FieldType]
  - Add `@field_validator("fields")` to validate unique field names
  - Raise ValidationError with duplicate field names if found

Run `pytest tests/test_schema.py` - ALL tests must pass
Commit: `feat(01-02): implement Pydantic schema models with validation`

**REFACTOR (if needed):**
- Extract validation logic if complex
- Add docstrings to each model class
- Ensure error messages are clear and include context
- Run tests - must still pass
- Commit if changes made: `refactor(01-02): improve schema validation clarity`

  </implementation>
</feature>

<verification>
After TDD cycle completion:

1. `pytest tests/test_schema.py -v` - All tests pass
2. `python -c "from bitschema.schema import BitSchema; from bitschema.types import BooleanField; BitSchema(fields=[BooleanField(name='test', type='boolean')])"` - Creates valid schema
3. `python -c "from bitschema.schema import BitSchema; from bitschema.types import BooleanField; BitSchema(fields=[BooleanField(name='x', type='boolean'), BooleanField(name='x', type='boolean')])"` - Raises ValidationError with "duplicate" message
4. Schema models handle all TYPE-01, TYPE-02, TYPE-03, SCHEMA-03, SCHEMA-04 requirements
</verification>

<success_criteria>
- BooleanField, IntegerField, EnumField Pydantic models exist and validate correctly
- BitSchema model validates unique field names (SCHEMA-04)
- Invalid schemas raise Pydantic ValidationError with clear messages
- IntegerField validates max_value >= min_value (TYPE-05)
- EnumField validates non-empty, unique values (TYPE-03)
- All tests in test_schema.py pass
- TDD cycle complete: RED → GREEN → (REFACTOR if needed)
- 2-3 commits created following TDD pattern
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-02-SUMMARY.md`
</output>
